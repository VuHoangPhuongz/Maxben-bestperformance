<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B·∫£n ƒë·ªì ƒê·∫°i l√Ω Maxben</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://code.highcharts.com/maps/highmaps.js"></script>
    <script src="https://code.highcharts.com/maps/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/mapdata/countries/vn/vn-all.js"></script>
    <style>
        /* CSS t·ª´ ve-chung-toi.html cho header/footer v√† t·ªïng th·ªÉ */
        body {
            font-family: 'Be Vietnam Pro', sans-serif; /* Consistent font with ve-chung-toi */
            background-color: #020617; /* Consistent background with ve-chung-toi */
            color: #d1d5db; /* Default text color for dark background */
        }
        .gradient-text {
            background: linear-gradient(90deg, #38bdf8, #a78bfa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .sticky-nav{
            position:sticky;
            top:0;
            z-index:50;
            background-color:rgba(17,24,39,0.8);
            backdrop-filter:blur(10px);
        }
        #product-dropdown-menu a {
            display: block;
            padding: 0.6rem 1rem;
            border-radius: 0.375rem;
            color: #d1d5db;
            font-size: 0.875rem;
            white-space: nowrap;
            transition: background-color 0.2s, color 0.2s;
        }
        #product-dropdown-menu a:hover {
            background-color: #2563EB;
            color: #ffffff;
        }

        /* CSS c·ªßa du-lieu.html (c√≥ ƒëi·ªÅu ch·ªânh ƒë·ªÉ ph√π h·ª£p v·ªõi n·ªÅn t·ªëi v√† to√†n b·ªô main l√† tr·∫Øng) */
        #container { height: 70vh; min-width: 310px; width: 100%; border-radius: 0.75rem; }
        /* Tooltip background for Highcharts - should be dark to fit overall theme */
        .highcharts-tooltip span { background-color: #1a202c; border: 1px solid #4a5568; padding: 10px; border-radius: 8px; color: #d1d5db; box-shadow: 0 2px 5px rgba(0,0,0,0.3); }

        /* Custom notification style */
        #notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #B91C1C; /* Dark Red */
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s, visibility 0.5s, transform 0.5s;
            transform: translateY(-20px);
        }
        #notification.show { opacity: 1; visibility: visible; transform: translateY(0); }
        #notification.error { background-color: #991B1B; } /* Even darker for error */

        /* Custom scrollbar for dealer list (adjusted for light background within info box) */
        #dealer-list::-webkit-scrollbar { width: 8px; }
        #dealer-list::-webkit-scrollbar-track { background: #e5e7eb; border-radius: 10px; } /* Light track */
        #dealer-list::-webkit-scrollbar-thumb { background-color: #f87171; border-radius: 10px; border: 2px solid #e5e7eb; }
        #dealer-list::-webkit-scrollbar-thumb:hover { background-color: #ef4444; }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body class="bg-slate-950 text-gray-300">

    <div id="notification"></div>

    <header class="sticky-nav border-b border-gray-700">
        <div class="container mx-auto px-4">
            <nav class="flex items-center justify-between h-20">
                   <a href="index.html" class="text-3xl font-bold text-red-500">MAXBENüí°</a>
                <div class="hidden md:flex items-center space-x-6 lg:space-x-8">
                    <a href="index.html" class="text-gray-300 hover:text-white transition-colors">Trang Ch·ªß</a>
                    <a href="ve-chung-toi.html" class="text-gray-300 hover:text-white">V·ªÅ Ch√∫ng T√¥i</a>
                    <a href="du-an.html" class="text-gray-300 hover:text-white transition-colors">D·ª± √Ån & T∆∞ V·∫•n</a>
<div class="relative group">
    <a href="san-pham.html" class="text-gray-300 hover:text-white transition-colors flex items-center py-2">
        S·∫£n Ph·∫©m
        <i class="fas fa-chevron-down text-xs ml-2 transition-transform duration-300 group-hover:rotate-180"></i>
    </a>
    <div id="product-dropdown-menu" class="absolute top-full left-1/2 -translate-x-1/2 mt-3 w-60 bg-slate-800 border border-slate-700 rounded-lg shadow-lg p-2 z-50
        opacity-0 invisible group-hover:opacity-100 group-hover:visible transform -translate-y-2 group-hover:translate-y-0
        transition-all duration-300 ease-in-out">
        <div class="text-center py-4">
            <i class="fas fa-spinner fa-spin text-white"></i>
        </div>
    </div>
</div>
                    <a href="du-lieu.html" class="text-gray-300 hover:text-white transition-colors">D·ªØ li·ªáu kh√°ch h√†ng</a>
                    <a href="TCO.html" class="text-gray-300 hover:text-white transition-colors">C√¥ng c·ª• t√≠nh TCO</a>
                </div>
                <div class="flex items-center">
                     <a href="tel:0886666730" class="cta-button bg-blue-600 text-white font-semibold py-2 px-5 rounded-lg shadow-lg hidden md:block">
                       üìû G·ªçi Ngay
                    </a>
                    <div class="md:hidden ml-4">
                        <button id="mobile-menu-button" class="text-gray-300 hover:text-white focus:outline-none">
                            <i class="fas fa-bars fa-lg"></i>
                        </button>
                    </div>
                </div>
            </nav>
        </div>
        <div id="mobile-menu" class="hidden md:hidden px-4 pb-4">
    <a href="index.html" class="block py-2 text-gray-300 hover:text-white">Trang Ch·ªß</a>
      <a href="ve-chung-toi.html" class="text-gray-300 hover:text-white">V·ªÅ Ch√∫ng T√¥i</a>
    <div class="relative group">
        <a href="san-pham.html" class="block py-2 text-gray-300 hover:text-white flex items-center justify-between">
            S·∫£n Ph·∫©m
            <i class="fas fa-chevron-down text-xs ml-2 transition-transform duration-300"></i>
        </a>
        <div id="mobile-product-categories-list" class="pl-4 border-l border-gray-700 mt-2 space-y-1">
            </div>
    </div>
    <a href="du-an.html" class="block py-2 text-gray-300 hover:text-white">D·ª± √Ån & T∆∞ V·∫•n</a>
    <a href="du-lieu.html" class="block py-2 text-gray-300 hover:text-white">D·ªØ li·ªáu kh√°ch h√†ng</a>
    <a href="TCO.html" class="block py-2 text-gray-300 hover:text-white">C√¥ng c·ª• t√≠nh TCO</a>
    <a href="tel:0886666730" class="block py-2 text-gray-300 hover:text-white">üìû Li√™n H·ªá </a>
</div>
    </header>

    <main class="container mx-auto p-4 md:p-8 bg-white rounded-xl shadow-xl border border-gray-200">
        <header class="text-center mb-8">
            <div class="flex justify-center items-center gap-3">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
                </svg>
                <h1 class="text-3xl md:text-5xl font-extrabold text-red-700 tracking-tight">B·∫£n ƒë·ªì Ph√¢n ph·ªëi ƒê·∫°i l√Ω Maxben</h1>
            </div>
            <p class="text-lg text-gray-600 mt-3 max-w-3xl mx-auto">Kh√°m ph√° d·ªØ li·ªáu kinh doanh v√† ph√¢n ph·ªëi ƒë√®n LED tr√™n to√†n qu·ªëc. T∆∞∆°ng t√°c v·ªõi b·∫£n ƒë·ªì ƒë·ªÉ xem th√¥ng tin chi ti·∫øt theo t·ª´ng t·ªânh th√†nh.</p>
        </header>

        <div class="mb-8 bg-gray-50 p-6 rounded-xl shadow-inner border border-gray-200 hover:shadow-lg transition-shadow duration-300">
            <h3 class="font-bold text-xl text-gray-800 mb-4 flex items-center gap-2">
                <i class="fas fa-file-excel text-green-600"></i> T·∫£i l√™n d·ªØ li·ªáu t·ª´ Excel
            </h3>
            <div class="grid md:grid-cols-2 gap-6 items-center">
                <div>
                    <label for="file-upload" class="block text-sm font-medium text-gray-700 mb-2">Ch·ªçn file Excel ƒë·ªÉ nh·∫≠p d·ªØ li·ªáu:</label>
                    <input id="file-upload" type="file" accept=".xlsx, .xls" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2.5 file:px-5 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-red-50 file:text-red-700 hover:file:bg-red-100 cursor-pointer transition-colors duration-200"/>
                    <div id="loading-spinner" class="hidden mt-2 flex items-center gap-2 text-sm text-red-600">
                        <svg class="animate-spin h-5 w-5 text-red-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                        <span>ƒêang x·ª≠ l√Ω file...</span>
                    </div>
                </div>
                <div class="text-sm text-gray-700 bg-red-50 p-4 rounded-lg border border-red-200">
                    <p class="font-semibold text-red-800 flex items-center gap-2"><i class="fas fa-info-circle"></i> L∆∞u √Ω quan tr·ªçng:</p>
                    <ul class="list-disc list-inside mt-2 space-y-1">
                        <li>File Excel c·∫ßn c√≥ c√°c c·ªôt: <code class="font-mono text-red-700">hc-key</code>, <code class="font-mono text-red-700">daiLy</code>, <code class="font-mono text-red-700">khachHang</code>, v√† <code class="font-mono text-red-700">spBanChay</code>.</li>
                        <li>ƒê·ªÉ nh·∫≠p nhi·ªÅu m·ª•c trong m·ªôt √¥ (v√≠ d·ª•: nhi·ªÅu ƒë·∫°i l√Ω), h√£y ngƒÉn c√°ch b·∫±ng d·∫•u ph·∫©y ",".</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="flex flex-col lg:flex-row gap-8">
            <div class="w-full lg:w-2/3 bg-white p-4 rounded-xl shadow-xl border border-gray-200">
                <div id="container"></div>
            </div>

            <div class="w-full lg:w-1/3">
                 <div id="info-box" class="bg-white p-6 rounded-xl shadow-xl h-full sticky top-20 border border-gray-200">
                    <div id="info-content" class="mt-4 text-gray-700 h-full flex flex-col justify-center items-center text-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-red-200 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1"><path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                        <h3 class="text-xl font-semibold text-gray-700">Th√¥ng tin Chi ti·∫øt T·ªânh/Th√†nh</h3>
                        <p class="text-sm text-gray-500 mt-2">B·∫•m v√†o m·ªôt t·ªânh tr√™n b·∫£n ƒë·ªì ƒë·ªÉ xem d·ªØ li·ªáu ph√¢n ph·ªëi.</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-slate-900 border-t border-slate-800 mt-8">
        <div class="container mx-auto px-6 py-12">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8">
                <div class="col-span-1 md:col-span-2">
                    <a href="index.html" class="text-2xl font-bold text-red-500">MAXBENüí°</a>
                    <p class="text-gray-400 text-sm mt-4 max-w-sm">Ki·∫øn t·∫°o kh√¥ng gian b·∫±ng √°nh s√°ng ch·∫•t l∆∞·ª£ng v√† gi·∫£i ph√°p chuy√™n nghi·ªáp.</p>
                </div>
                <div>
                    <h4 class="font-bold text-white mb-4 uppercase tracking-wider">Li√™n k·∫øt</h4>
                    <ul class="space-y-2 text-sm">
                        <li><a href="#" class="text-gray-400 hover:text-amber-400 transition-colors">V·ªÅ Ch√∫ng T√¥i</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-amber-400 transition-colors">S·∫£n Ph·∫©m</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-amber-400 transition-colors">D·ª± √Ån</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-amber-400 transition-colors">Li√™n H·ªá</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-bold text-white mb-4 uppercase tracking-wider">K·∫øt n·ªëi</h4>
                    <div class="flex space-x-4">
                       <a href="#" class="text-gray-400 hover:text-blue-400 transition-colors" aria-label="Facebook"><i class="fab fa-facebook-f fa-lg"></i></a>
                       <a href="#" class="text-gray-400 hover:text-red-500 transition-colors" aria-label="YouTube"><i class="fab fa-youtube fa-lg"></i></a>
                       <a href="#" class="text-gray-400 hover:text-pink-500 transition-colors" aria-label="Instagram"><i class="fab fa-instagram fa-lg"></i></a>
                   </div>
                </div>
            </div>
            <div class="border-t border-slate-800 pt-8 text-center text-sm text-gray-500">
                <p>&copy; 2025 MAXBEN. All Rights Reserved.</p>
            </div>
        </div>
    </footer>


    <script>
        // Start of du-lieu.html specific JavaScript logic
        let chart;
        let provinceData = {};
        const provinceNameMap = {
            'vn-hn': 'H√† N·ªôi', 'vn-hc': 'TP. H·ªì Ch√≠ Minh', 'vn-hp': 'H·∫£i Ph√≤ng', 'vn-da': 'ƒê√† N·∫µng', 'vn-ct': 'C·∫ßn Th∆°',
            'vn-ag': 'An Giang', 'vn-br': 'B√† R·ªãa - V≈©ng T√†u', 'vn-bk': 'B·∫Øc K·∫°n', 'vn-bg': 'B·∫Øc Giang', 'vn-bl': 'B·∫°c Li√™u',
            'vn-bn': 'B·∫Øc Ninh', 'vn-bt': 'B·∫øn Tre', 'vn-bi': 'B√¨nh ƒê·ªãnh', 'vn-bd': 'B√¨nh D∆∞∆°ng', 'vn-bp': 'B√¨nh Ph∆∞·ªõc',
            'vn-bu': 'B√¨nh Thu·∫≠n', 'vn-cm': 'C√† Mau', 'vn-cb': 'Cao B·∫±ng', 'vn-dl': 'ƒê·∫Øk L·∫Øk', 'vn-do': 'ƒê·∫Øk N√¥ng',
            'vn-db': 'ƒêi·ªán Bi√™n', 'vn-dn': 'ƒê·ªìng Nai', 'vn-dt': 'ƒê·ªìng Th√°p', 'vn-gl': 'Gia Lai', 'vn-hg': 'H√† Giang',
            'vn-hm': 'H√† Nam', 'vn-ht': 'H√† Tƒ©nh', 'vn-hd': 'H·∫£i D∆∞∆°ng', 'vn-711': 'H·∫≠u Giang', 'vn-hb': 'H√≤a B√¨nh',
            'vn-hy': 'H∆∞ng Y√™n', 'vn-kh': 'Kh√°nh H√≤a', 'vn-kg': 'Ki√™n Giang', 'vn-kt': 'Kon Tum', 'vn-li': 'Lai Ch√¢u',
            'vn-ld': 'L√¢m ƒê·ªìng', 'vn-ls': 'L·∫°ng S∆°n', 'vn-lc': 'L√†o Cai', 'vn-la': 'Long An', 'vn-nd': 'Nam ƒê·ªãnh',
            'vn-na': 'Ngh·ªá An', 'vn-nb': 'Ninh B√¨nh', 'vn-nt': 'Ninh Thu·∫≠n', 'vn-pt': 'Ph√∫ Th·ªç', 'vn-py': 'Ph√∫ Y√™n',
            'vn-qb': 'Qu·∫£ng B√¨nh', 'vn-qm': 'Qu·∫£ng Nam', 'vn-qg': 'Qu·∫£ng Ng√£i', 'vn-qn': 'Qu·∫£ng Ninh', 'vn-qt': 'Qu·∫£ng Tr·ªã',
            'vn-st': 'S√≥c TrƒÉng', 'vn-sl': 'S∆°n La', 'vn-tn': 'T√¢y Ninh', 'vn-tb': 'Th√°i B√¨nh', 'vn-ty': 'Th√°i Nguy√™n',
            'vn-th': 'Thanh H√≥a', 'vn-tt': 'Th·ª´a Thi√™n Hu·∫ø', 'vn-tg': 'Ti·ªÅn Giang', 'vn-tv': 'Tr√† Vinh', 'vn-tq': 'Tuy√™n Quang',
            'vn-vl': 'Vƒ©nh Long', 'vn-vp': 'Vƒ©nh Ph√∫c', 'vn-yb': 'Y√™n B√°i'
        };

        // Initial dummy data for demonstration if local storage is empty
        const initialProvinceData = {
            'vn-hn': { daiLy: ['ƒê·∫°i l√Ω ThƒÉng Long', 'C·ª≠a h√†ng Minh Khai'], khachHang: ['T·∫≠p ƒëo√†n ABC', 'C√¥ng ty XYZ'], spBanChay: ['ƒê√®n LED √Çm tr·∫ßn 12W', 'ƒê√®n tu√Ωp LED 0.6m'] },
            'vn-hc': { daiLy: ['ƒê·∫°i l√Ω S√†i G√≤n', 'Chi nh√°nh Q.1'], khachHang: ['C√¥ng ty DEF'], spBanChay: ['ƒê√®n ƒê∆∞·ªùng LED 150W'] },
            'vn-dn': { daiLy: ['ƒê·∫°i l√Ω S√¥ng H√†n'], khachHang: [], spBanChay: ['ƒê√®n Downlight 9W'] },
            'vn-na': { daiLy: ['ƒê·∫°i l√Ω Vinh'], khachHang: ['D·ª± √°n Chung c∆∞'], spBanChay: ['ƒê√®n Nh√† x∆∞·ªüng 200W'] }
        };

        function showNotification(message, isError = false) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = 'show'; // Resets and adds 'show'
            if (isError) {
                notification.classList.add('error');
            } else {
                notification.classList.remove('error'); // Ensure error class is removed for success messages
            }
            setTimeout(() => {
                notification.className = ''; // Hides and resets transition
            }, 3000);
        }

        function saveDataToLocalStorage(data) {
            try {
                localStorage.setItem('maxbenProvinceData', JSON.stringify(data));
            } catch (error) {
                console.error("L·ªói khi l∆∞u d·ªØ li·ªáu v√†o LocalStorage:", error);
                showNotification("L·ªói khi l∆∞u d·ªØ li·ªáu. Vui l√≤ng ki·ªÉm tra c√†i ƒë·∫∑t tr√¨nh duy·ªát.", true);
            }
        }

        function loadDataFromLocalStorage() {
            const savedData = localStorage.getItem('maxbenProvinceData');
            if (savedData) {
                try {
                    const parsedData = JSON.parse(savedData);
                    // Basic validation to ensure it's an object and not null
                    if (typeof parsedData === 'object' && parsedData !== null) {
                        return parsedData;
                    }
                } catch (error) {
                    console.error("L·ªói khi ƒë·ªçc d·ªØ li·ªáu t·ª´ LocalStorage:", error);
                    // If corrupted, return initial data and notify
                    showNotification("D·ªØ li·ªáu l∆∞u tr·ªØ b·ªã l·ªói ho·∫∑c c≈©. ƒêang t·∫£i d·ªØ li·ªáu m·∫∑c ƒë·ªãnh.", true);
                    return initialProvinceData;
                }
            }
            return initialProvinceData; // Return initial data if nothing saved or error
        }

        function redrawMap() {
            const seriesData = Highcharts.maps['countries/vn/vn-all'].features.map(p => ({
                'hc-key': p.properties['hc-key'],
                value: provinceData[p.properties['hc-key']] ? 100 : 10, // Highlight if data exists
                name: provinceNameMap[p.properties['hc-key']] || p.properties.name
            }));

            if (chart) {
                chart.series[0].setData(seriesData, true);
            }

            // Reset info box content
            document.getElementById('info-content').innerHTML = `
                <div class="h-full flex flex-col justify-center items-center text-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-red-200 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1"><path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                    <h3 class="text-xl font-semibold text-gray-700">Th√¥ng tin Chi ti·∫øt T·ªânh/Th√†nh</h3>
                    <p class="text-sm text-gray-500 mt-2">B·∫•m v√†o m·ªôt t·ªânh tr√™n b·∫£n ƒë·ªì ƒë·ªÉ xem d·ªØ li·ªáu ph√¢n ph·ªëi.</p>
                </div>
            `;
        }

        function initializeMap() {
            const seriesData = Highcharts.maps['countries/vn/vn-all'].features.map(p => ({
                'hc-key': p.properties['hc-key'],
                value: provinceData[p.properties['hc-key']] ? 100 : 10, // Value determines color, 100 if data, 10 if not
                name: provinceNameMap[p.properties['hc-key']] || p.properties.name
            }));

            chart = Highcharts.mapChart('container', {
                chart: {
                    map: 'countries/vn/vn-all',
                    backgroundColor: '#FFFFFF' // Set background to white for the map
                },
                title: {
                    text: null // No chart title
                },
                subtitle: {
                    text: null // No chart subtitle
                },
                mapNavigation: {
                    enabled: true,
                    buttonOptions: {
                        verticalAlign: 'bottom',
                        align: 'right',
                        theme: { // Adjust button theme for light background
                            fill: '#f0f0f0', // Lighter background for buttons
                            stroke: '#cccccc',
                            'stroke-width': 1,
                            r: 5,
                            style: {
                                color: '#333333' // Darker text color
                            },
                            states: {
                                hover: {
                                    fill: '#e0e0e0',
                                    style: {
                                        color: '#000000'
                                    }
                                },
                                select: {
                                    fill: '#d0d0d0',
                                    style: {
                                        color: '#000000'
                                    }
                                }
                            }
                        }
                    }
                },
                colorAxis: {
                    min: 0,
                    stops: [
                        [0, '#FEE2E2'], // Lightest red for no data (Tailwind red-100)
                        [0.8, '#DC2626'], // Medium red for some data (Tailwind red-700)
                        [1, '#991B1B']   // Darkest red for data presence (Tailwind red-800)
                    ],
                    visible: false // Hide the color axis legend
                },
                legend: {
                    enabled: false // Hide the legend
                },
                tooltip: {
                    formatter: function () {
                        const info = provinceData[this.point['hc-key']];
                        const provinceName = provinceNameMap[this.point['hc-key']] || this.point.name;
                        let text = `<b style="font-size: 14px; color: #333;">${provinceName}</b><br/>`; // Adjust text color for light tooltip
                        text += info ? `S·ªë ƒë·∫°i l√Ω: <b>${info.daiLy?.length || 0}</b>` : 'Ch∆∞a c√≥ d·ªØ li·ªáu';
                        return text;
                    }
                },
                plotOptions: {
                    series: {
                        point: {
                            events: {
                                click: function () {
                                    const data = provinceData[this['hc-key']];
                                    const infoContent = document.getElementById('info-content');
                                    const provinceName = provinceNameMap[this['hc-key']] || this.name;

                                    if (data) {
                                        const createGenericList = (items) => {
                                            return (items && items.length)
                                                ? items.map(x => `<li class="py-1.5 px-3 bg-red-50 text-red-800 rounded-md mb-1.5 text-sm">${x}</li>`).join('')
                                                : '<li class="text-xs italic text-gray-500">Ch∆∞a c√≥ d·ªØ li·ªáu</li>';
                                        };

                                        infoContent.innerHTML = `
                                            <div class="flex items-center gap-3 mb-4 border-b border-gray-200 pb-3">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                                                <h3 class="text-2xl font-bold text-gray-800">${provinceName}</h3>
                                            </div>
                                            <div class="space-y-5">
                                                <div>
                                                    <b class="text-gray-700">ƒê·∫°i l√Ω (${data.daiLy?.length || 0}):</b>
                                                    <div class="relative mt-2">
                                                        <span class="absolute inset-y-0 left-0 flex items-center pl-3"><svg class="w-5 h-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" /></svg></span>
                                                        <input type="text" id="dealer-search" placeholder="T√¨m ki·∫øm ƒë·∫°i l√Ω..." class="block w-full text-sm border-gray-200 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500 p-2 pl-10 text-gray-800 bg-white">
                                                    </div>
                                                    <ul id="dealer-list" class="mt-2 list-none max-h-36 overflow-y-auto pr-2">${createGenericList(data.daiLy)}</ul>
                                                </div>
                                                <div><b class="text-gray-700">Kh√°ch h√†ng (${data.khachHang?.length || 0}):</b> <ul class="mt-2 list-none">${createGenericList(data.khachHang)}</ul></div>
                                                <div><b class="text-gray-700">S·∫£n ph·∫©m b√°n ch·∫°y:</b> <ul class="mt-2 list-none">${createGenericList(data.spBanChay)}</ul></div>
                                            </div>
                                        `;
                                        // Add event listener for search input
                                        const searchInput = document.getElementById('dealer-search');
                                        if (searchInput) {
                                            searchInput.addEventListener('input', function() {
                                                const filter = this.value.toLowerCase();
                                                const items = document.querySelectorAll('#dealer-list li');
                                                items.forEach(item => {
                                                    const itemText = (item.textContent || item.innerText).toLowerCase();
                                                    item.style.display = itemText.includes(filter) ? "" : "none";
                                                });
                                            });
                                        }
                                    } else {
                                        infoContent.innerHTML = `
                                            <div class="h-full flex flex-col justify-center items-center text-center">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-red-200 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1"><path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                                                <p class="italic text-gray-500">Kh√¥ng c√≥ d·ªØ li·ªáu cho <b>${provinceName}</b>.</p>
                                            </div>
                                        `;
                                    }
                                }
                            }
                        }
                    }
                },
                series: [{
                    data: seriesData,
                    name: 'T√¨nh h√¨nh kinh doanh',
                    states: {
                        hover: {
                            color: '#F87171' // Lighter red on hover (Tailwind red-400)
                        }
                    },
                    dataLabels: {
                        enabled: true,
                        formatter: function () {
                            return provinceNameMap[this.point['hc-key']] || this.point.name;
                        },
                        style: {
                            color: '#881337', // Darker red for labels to stand out on white map
                            fontSize: '9px',
                            fontWeight: 'bold',
                            textOutline: 'none' // Remove text outline for cleaner look
                        }
                    }
                }]
            });
        }

        function handleFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            const spinner = document.getElementById('loading-spinner');
            spinner.classList.remove('hidden');

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const workbook = XLSX.read(new Uint8Array(e.target.result), { type: 'array' });
                    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);

                    let updatedCount = 0;
                    jsonData.forEach(row => {
                        const hcKey = row['hc-key']; // Expected column name for province key
                        if (hcKey && provinceNameMap[hcKey]) {
                            provinceData[hcKey] = {
                                daiLy: row.daiLy ? String(row.daiLy).split(',').map(s => s.trim()) : [],
                                khachHang: row.khachHang ? String(row.khachHang).split(',').map(s => s.trim()) : [],
                                spBanChay: row.spBanChay ? String(row.spBanChay).split(',').map(s => s.trim()) : []
                            };
                            updatedCount++;
                        }
                    });

                    if (updatedCount > 0) {
                        redrawMap();
                        saveDataToLocalStorage(provinceData);
                        showNotification(`ƒê√£ c·∫≠p nh·∫≠t th√†nh c√¥ng d·ªØ li·ªáu cho ${updatedCount} t·ªânh/th√†nh!`);
                    } else {
                        showNotification('File Excel kh√¥ng c√≥ d·ªØ li·ªáu h·ª£p l·ªá ho·∫∑c c·ªôt "hc-key" b·ªã thi·∫øu.', true);
                    }

                } catch (error) {
                    console.error("L·ªói khi x·ª≠ l√Ω file Excel:", error);
                    showNotification("L·ªói khi ƒë·ªçc file. Vui l√≤ng ki·ªÉm tra ƒë·ªãnh d·∫°ng file.", true);
                } finally {
                    spinner.classList.add('hidden');
                    event.target.value = ''; // Clear the file input
                }
            };

            reader.onerror = function() {
                spinner.classList.add('hidden');
                showNotification('Kh√¥ng th·ªÉ ƒë·ªçc file ƒë√£ ch·ªçn.', true);
            };

            reader.readAsArrayBuffer(file);
        }

        document.addEventListener('DOMContentLoaded', function() {
            provinceData = loadDataFromLocalStorage();
            initializeMap();
            document.getElementById('file-upload').addEventListener('change', handleFile, false);

            // Mobile Menu Toggle (from ve-chung-toi.html)

            const mobileMenu = document.getElementById('mobile-menu');
            if(mobileMenuButton && mobileMenu) {
                mobileMenuButton.addEventListener('click', () => {
                    mobileMenu.classList.toggle('hidden');
                });
            }
        });
        // End of du-lieu.html specific JavaScript logic
    </script>

    <script src="product-details.js"></script>
    <script src="san-pham.js"></script>
      <script src="main-layout.js"></script> 
</body>
</html>